# 服务接口反爬虫设计

## 基本框架

- 客户端包名授权、系统（安卓、ios）授权、版本授权

    包名下架（适合马甲包）

    系统：一般用不上，有些应用会只选择在ios对接

    版本：一般强升版本后，旧版本就不能使用，方便升级更高的反爬方案

- 客户端添加签名值

    一般包括设备号、时间戳、授权Key值

    签名一般会使用请求参数名排序然后组成字符串得到哈希值，常用的有Md5，Sha-256

- 客户端请求加密

    加密请求参数名和参数值，一般使用aes或者rsa

- 服务端返回数据加密

    一般返回数据比较长，所以大多都是使用对称加密为主，例如：aes、3des

    因为返回密文基本都是base64字符串，所以可以在字符串下点功夫，譬如替换某些字符，或者调整base64的长度，填充头或者填充尾，因为base64长度不对，转二进制的时候会报错


## 签名

在  SecurityTest.cs 会介绍到常用的几种签名算法

## 对称加密
一般对称加密是最容易Hook的加密方式，因为就一个密钥和向量，而且几乎都是基于des。所以想为了增加难度，最好出一套自己的返回数据的协议，而非简单的返回Json字符串

## 非对称加密

非对称加密之所以有难度，第一密钥的格式有好几种，第二，每次同一个字符串加密后的密文都不一样的，增加了跟客户端核对的难度，特别在字符串编码上

SecurityTest.cs 提供了主流的对称加密以及密钥串的生成，不过得引用BouncyCastle组件，省去了在非对称加密少走弯路


## Demo
代码开头附带一个简单的反爬设计，提供学习。万变不离其宗，再好的方案也会有给人逆向的时候，所以心态摆正就好。



Enjoy～  ^_^





## 新生命开发团队
![XCode](https://newlifex.com/logo.png)  

新生命团队（NewLife）成立于2002年，是新时代物联网行业解决方案提供者，致力于提供软硬件应用方案咨询、系统架构规划与开发服务。  
团队主导的70多个开源项目已被广泛应用于各行业，Nuget累计下载量高达100余万次。  
团队开发的大数据中间件NewLife.XCode、蚂蚁调度计算平台AntJob、星尘分布式平台Stardust、缓存队列组件NewLife.Redis以及物联网平台FIoT，均成功应用于电力、高校、互联网、电信、交通、物流、工控、医疗、文博等行业，为客户提供了大量先进、可靠、安全、高质量、易扩展的产品和系统集成服务。  

我们将不断通过服务的持续改进，成为客户长期信赖的合作伙伴，通过不断的创新和发展，成为国内优秀的IoT服务供应商。  

`新生命团队始于2002年，部分开源项目具有20年以上漫长历史，源码库保留有2010年以来所有修改记录`  
网站：https://newlifex.com  
开源：https://github.com/newlifex  
QQ群：1600800/1600838  
微信公众号：  
![智能大石头](https://newlifex.com/stone.jpg)  