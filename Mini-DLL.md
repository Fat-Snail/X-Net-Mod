# Mini-DLL - .NET 程序集清理工具

## 简介

Mini-DLL 是一个基于 .NET 10 最新运行单个 C# 源文件功能的程序集清理工具。它能够智能分析 .NET 应用程序的依赖关系，自动识别并清理未使用的程序集文件、语言包文件以及其他临时文件，从而显著减小发布包体积，优化存储空间。

## 功能特点

- **智能依赖分析**：自动分析入口程序集的所有依赖，精确识别被引用的程序集
- **多种清理模式**：支持仅分析、预精简、直接清理和生成报告四种操作模式
- **安全保护机制**：提供白名单功能，防止误删重要程序集
- **交互式操作**：提供友好的命令行交互界面，操作简单直观
- **详细报告生成**：可生成详细的分析报告，便于审查和记录

## 使用前提

- **.NET 运行时**：需要安装 .NET 10 或更高版本
- **运行方式**：可直接使用 `dotnet run` 运行 C# 源文件

## 使用方法

### 交互模式

```bash
dotnet run mini-dll.cs
```

运行后，工具会进入交互式界面，按提示选择操作模式、配置目录等选项。

### 命令行模式

```bash
dotnet run mini-dll.cs [选项]
```

## 选项说明

| 选项 | 简写 | 说明 |
|------|------|------|
| `--analyze` | `-a` | 仅分析，不执行清理 |
| `--preview` | `-p` | 预精简模式（显示将要清理的文件） |
| `--report` | | 生成详细报告 |
| `--dir <目录>` | `-d` | 要分析的目录 |
| `--entry <文件>` | `-e` | 入口程序集 |
| `--whitelist <列表>` | `-w` | 白名单（逗号分隔） |
| `--recursive` | `-r` | 递归扫描子目录 |
| `--no-locale` | | 清理语言包文件 |
| `--clean-other` | | 清理其他文件(.pdb/.xml等) |
| `--verbose` | `-v` | 显示详细日志 |
| `--help` | `-h` | 显示帮助信息 |

## 交互模式功能

1. **仅分析**：查看当前目录的可清理内容
2. **预精简**：显示精简前后的容量对比
3. **直接清理**：执行删除操作
4. **生成报告**：创建详细的清理报告
5. **退出**：结束程序

## 使用示例

### 示例 1：交互式操作

```bash
dotnet run mini-dll.cs
```

运行后，按提示选择操作模式、配置目录等信息。

### 示例 2：分析指定目录

```bash
dotnet run mini-dll.cs --analyze --dir ./publish
```

仅分析 `./publish` 目录，不执行删除操作。

### 示例 3：预精简模式查看效果

```bash
dotnet run mini-dll.cs --preview --dir ./bin/Release
```

预览 `./bin/Release` 目录的清理效果，显示将要删除的文件列表。

### 示例 4：直接清理（谨慎使用）

```bash
dotnet run mini-dll.cs --dir ./output --no-locale
```

直接清理 `./output` 目录，包括语言包文件。

## 工作原理

1. **依赖分析**：通过反射加载入口程序集，递归分析所有引用
2. **文件分类**：将文件分为程序集、语言包、其他文件三类
3. **使用判断**：对比分析结果与实际文件，识别未使用文件
4. **安全验证**：检查白名单和系统程序集，避免误删
5. **清理执行**：按模式执行分析、预览、删除或报告生成

## 注意事项

1. **建议先预览**：在执行删除操作前，务必先使用 `--analyze` 或 `--preview` 查看效果
2. **备份重要文件**：清理前请确保有重要文件的备份
3. **白名单保护**：对于需要保留的程序集，使用 `--whitelist` 参数添加保护
4. **系统程序集**：工具会自动识别系统程序集，不会清理它们
5. **语言包处理**：语言包文件（如 `.resources.dll`）默认不清理，需使用 `--no-locale` 参数

## 文件结构

```
mini-dll.cs                 # 主程序文件
├── CleanOptions           # 配置选项类
├── AnalysisResult         # 分析结果类
├── OperationMode          # 操作模式枚举
├── 核心函数               # 分析、清理、报告等功能
└── 工具函数               # 辅助功能函数
```

## 常见问题

### Q: 工具是否会误删系统程序集？
A: 不会。工具内置了系统程序集识别逻辑，会自动跳过 `System.`、`Microsoft.`、`Windows.` 等前缀的程序集。

### Q: 如何保留特定的程序集？
A: 使用 `--whitelist` 参数，如 `--whitelist "MyLibrary,Utility"`。

### Q: 清理后程序无法运行怎么办？
A: 请检查是否误删了依赖的程序集，可以使用备份文件恢复，或重新构建应用程序。

### Q: 是否支持跨平台？
A: 是的，只要安装了 .NET 10 运行时，可在 Windows、Linux、macOS 上运行。

## 作者信息

- **作者**：Fatty Coder
- **版权**：© 2024-2025 Fatty Coder
- **官网**：https://github.com/Fat-Snail
- **技术栈**：基于 .NET 10 单文件运行功能

## 更新日志

- **v1.0** (2025-01-04)
  - 初始版本发布
  - 支持四种操作模式
  - 提供交互式和命令行两种使用方式
  - 实现智能依赖分析和安全清理

---

> **提示**：本工具为开源项目，使用过程中遇到问题或有改进建议，欢迎提交 Issue 或 Pull Request。